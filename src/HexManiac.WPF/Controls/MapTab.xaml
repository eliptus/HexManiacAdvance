<UserControl x:Class="HavenSoft.HexManiac.WPF.Controls.MapTab"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:res="clr-namespace:HavenSoft.HexManiac.WPF.Resources"
             xmlns:local="clr-namespace:HavenSoft.HexManiac.WPF.Controls"
             xmlns:tools="clr-namespace:HavenSoft.HexManiac.Core.ViewModels.Tools;assembly=HexManiac.Core"
             xmlns:map="clr-namespace:HavenSoft.HexManiac.Core.ViewModels.Map;assembly=HexManiac.Core"
             xmlns:models="clr-namespace:HavenSoft.HexManiac.Core.Models;assembly=HexManiac.Core"
             Focusable="True" KeyDown="HandleKeyDown">
   <UserControl.Resources>
      <local:EqualityToBooleanConverter x:Key="Equality" />
      <DataTemplate DataType="{x:Type tools:VisualComboOption}">
         <local:PixelImage />
      </DataTemplate>
   </UserControl.Resources>
   <UserControl.InputBindings>
      <KeyBinding Key="Left" Command="{Binding PanCommand}" CommandParameter="{x:Static map:MapDirection.Left}" />
      <KeyBinding Key="Right" Command="{Binding PanCommand}" CommandParameter="{x:Static map:MapDirection.Right}" />
      <KeyBinding Key="Up" Command="{Binding PanCommand}" CommandParameter="{x:Static map:MapDirection.Up}" />
      <KeyBinding Key="Down" Command="{Binding PanCommand}" CommandParameter="{x:Static map:MapDirection.Down}" />
      <KeyBinding Key="Escape" Command="{Binding CancelCommand}" />
      <KeyBinding Key="Delete" Command="{Binding DeleteCommand}" />
      <KeyBinding Key="Backspace" Command="{Binding DeleteCommand}" />
   </UserControl.InputBindings>
   <Grid ClipToBounds="True" Background="Transparent" MouseDown="BackgroundDown" MouseMove="BackgroundMove" MouseUp="BackgroundUp" MouseWheel="Wheel">
      <Grid.ColumnDefinitions>
         <ColumnDefinition Width="Auto" />
         <ColumnDefinition Width="*" />
      </Grid.ColumnDefinitions>
      <Grid.RowDefinitions>
         <RowDefinition Height="Auto" />
         <RowDefinition Height="*" />
      </Grid.RowDefinitions>

      <Decorator IsHitTestVisible="False" Width="30" Height="30" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="0,-60,0,0" Name="BackButtonWidget" />
      <Decorator IsHitTestVisible="False" Width="30" Height="30" HorizontalAlignment="Left" VerticalAlignment="Top" Margin="96,-60,0,0" Name="UndoButtonWidget" />

      <!-- Blocks Panel -->
      <DockPanel Grid.Column="0" Grid.RowSpan="2" Panel.ZIndex="1" Name="BlockPanel" Background="{DynamicResource Background}" MouseWheel="EatMouseWheel">
         <Rectangle Fill="{DynamicResource Backlight}" Width="1" DockPanel.Dock="Right" />
         <Grid DockPanel.Dock="Top">
            <local:AngleBorder Content="Blocks" Direction="Out" Width="100" HorizontalContentAlignment="Center" Margin="0,0,0,4" />
            <Button Width="20" Height="20" HorizontalAlignment="Right" Margin="1" Command="{res:MethodCommand Cancel}">
               <Path Data="{res:Icon Exit}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
               <Button.Style>
                  <Style TargetType="Button" BasedOn="{StaticResource {x:Type Button}}">
                     <Setter Property="Visibility" Value="Collapsed" />
                     <Style.Triggers>
                        <DataTrigger Binding="{Binding BlockEditorVisible}" Value="True">
                           <Setter Property="Visibility" Value="Visible" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding DrawMultipleTiles}" Value="True">
                           <Setter Property="Visibility" Value="Visible" />
                        </DataTrigger>
                     </Style.Triggers>
                  </Style>
               </Button.Style>
            </Button>
         </Grid>
         <Grid Width="{Binding Blocks.ScaledWidth}" MinHeight="100" DockPanel.Dock="Top">
            <Grid.RowDefinitions>
               <RowDefinition Height="Auto" MinHeight="112"/>
               <RowDefinition Height="75"/>
            </Grid.RowDefinitions>
            <CheckBox HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="5,10,10,35" Grid.Row="1"
                  Content="Automatic Movement Permission" IsChecked="{Binding AutoUpdateCollision}">
               <CheckBox.ToolTip>
                  <TextBlock>
                     Update Movement Permission Selection based on Most Common Permission for selected block.
                     <LineBreak/>
                     For example, if you select a tree, it'll set the movement permission based on other trees.
                  </TextBlock>
               </CheckBox.ToolTip>
            </CheckBox>
            <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" HorizontalAlignment="Left" Margin="0,10" Grid.Row="1">
               <local:AngleBorder Direction="Left" VerticalAlignment="Stretch">
                  <TextBlock Text="Movement:" Margin="4,0" Height="30"/>
               </local:AngleBorder>
               <local:AngleComboBox Direction="Out" Width="135" Height="20"
                  ItemsSource="{Binding PrimaryMap.BlockEditor.MovementPermissions}" SelectedIndex="{Binding CollisionIndex}" />
            </StackPanel>
            <StackPanel Orientation="Vertical" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,0,12" Grid.Row="1" Visibility="{Binding BlockEditorVisible, Converter={StaticResource BoolToVisibility}}">
               <local:AngleBorder Direction="Out" VerticalAlignment="Stretch" Content="Block ID" />
               <TextBlock Text="{Binding DrawBlockIndex}" HorizontalAlignment="Center" Margin="0,5,0,0" />
            </StackPanel>
            <Decorator Grid.Row="1" Height="20" VerticalAlignment="Bottom" HorizontalAlignment="Right" Margin="0,0,30,55" Visibility="{Binding BlockEditorVisible, Converter={StaticResource BoolToVisibility}}">
               <local:AngleButton DataContext="{Binding PrimaryMap.BlockEditor}" Content="Edit Block" x:Name="EditBlockButton"
                   Direction="Right" Padding="2,0" Command="{res:MethodCommand ToggleShowTiles}" />
            </Decorator>
            <Decorator HorizontalAlignment="Center" VerticalAlignment="Center">
               <local:PixelImage DataContext="{Binding MultiTileDrawRender}" />
               <Decorator.Style>
                  <Style TargetType="Decorator">
                     <Setter Property="Visibility" Value="Collapsed" />
                     <Style.Triggers>
                        <DataTrigger Binding="{Binding BlockEditorVisible}" Value="True">
                           <Setter Property="Visibility" Value="Visible" />
                        </DataTrigger>
                        <DataTrigger Binding="{Binding DrawMultipleTiles}" Value="True">
                           <Setter Property="Visibility" Value="Visible" />
                        </DataTrigger>
                     </Style.Triggers>
                  </Style>
               </Decorator.Style>
            </Decorator>
            <TextBlock Foreground="{DynamicResource Secondary}" VerticalAlignment="Center" HorizontalAlignment="Center" TextAlignment="Center">
               <TextBlock.Style>
                  <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                     <Setter Property="Visibility" Value="Collapsed" />
                     <Style.Triggers>
                        <MultiDataTrigger>
                           <MultiDataTrigger.Conditions>
                              <Condition Binding="{Binding BlockEditorVisible}" Value="False" />
                              <Condition Binding="{Binding DrawMultipleTiles}" Value="False" />
                           </MultiDataTrigger.Conditions>
                           <MultiDataTrigger.Setters>
                              <Setter Property="Visibility" Value="Visible" />
                           </MultiDataTrigger.Setters>
                        </MultiDataTrigger>
                     </Style.Triggers>
                  </Style>
               </TextBlock.Style>
               <Run Text="(No Block Selected)" FontStyle="Italic" />
               <LineBreak />
               <Run Text="Click a block below to select it, or" />
               <LineBreak />
               <Run Text="Right-Click the map to select a block." />
            </TextBlock>
         </Grid>
         <ScrollViewer Name="BlockViewer" Margin="0,0,-1,0">
            <Canvas Width="{Binding Blocks.ScaledWidth}" Height="{Binding Blocks.ScaledHeight}">
               <local:PixelImage DataContext="{Binding Blocks}" MouseDown="BlocksDown" MouseMove="BlocksMove" MouseUp="BlocksUp" />
               <ContentControl IsHitTestVisible="False" Canvas.Left="{Binding HighlightBlockX}" Canvas.Top="{Binding HighlightBlockY}" Margin="-1,-1,0,0">
                  <ContentControl.Template>
                     <ControlTemplate>
                        <Rectangle StrokeThickness="1" Opacity=".5" Width="{Binding HighlightBlockWidth}" Height="{Binding HighlightBlockHeight}" RenderTransformOrigin=".5,.5"
                              Stroke="{DynamicResource Background}" Fill="{DynamicResource Primary}">
                           <Rectangle.RenderTransform>
                              <ScaleTransform x:Name="SelectionScale" />
                           </Rectangle.RenderTransform>
                        </Rectangle>
                        <ControlTemplate.Triggers>
                           <DataTrigger Binding="{Binding BlockSelectionToggle}" Value="True">
                              <DataTrigger.EnterActions>
                                 <BeginStoryboard>
                                    <Storyboard>
                                       <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleX" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                       <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleY" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                    </Storyboard>
                                 </BeginStoryboard>
                              </DataTrigger.EnterActions>
                              <DataTrigger.ExitActions>
                                 <BeginStoryboard>
                                    <Storyboard>
                                       <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleX" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                       <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleY" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                    </Storyboard>
                                 </BeginStoryboard>
                              </DataTrigger.ExitActions>
                           </DataTrigger>
                        </ControlTemplate.Triggers>
                     </ControlTemplate>
                  </ContentControl.Template>
               </ContentControl>
            </Canvas>
         </ScrollViewer>
      </DockPanel>

      <!-- Events Panel -->
      <DockPanel Grid.Column="0" Grid.RowSpan="2" Background="{DynamicResource Background}" Panel.ZIndex="1" Name="EventPanel"
         Width="{Binding ActualWidth, ElementName=BlockPanel}" Visibility="{Binding ShowEventPanel, Converter={StaticResource BoolToVisibility}}">
         <Grid DockPanel.Dock="Top" >
            <local:AngleBorder Width="100" Content="Events" HorizontalContentAlignment="Center" Direction="Out" />
            <ToggleButton IsChecked="{Binding ShowEventPanel}" Width="20" Height="20" HorizontalAlignment="Right" Margin="1">
               <Path Data="{res:Icon Exit}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
            </ToggleButton>
         </Grid>
         <Grid DockPanel.Dock="Top" Name="EventCategorySelector" Height="24">
            <Grid.ColumnDefinitions>
               <ColumnDefinition />
               <ColumnDefinition />
               <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <local:AngleButton Grid.Column="0" Margin="2,0" Content="Prev Group" Direction="Left" VerticalAlignment="Bottom"
                  Command="{Binding SelectedEvent.CycleEventCommand}" CommandParameter="{x:Static map:EventCycleDirection.PreviousCategory}" />
            <TextBlock Grid.Column="1" TextAlignment="Center" Text="{Binding SelectedEvent.EventType}" />
            <local:AngleButton Grid.Column="2" Margin="2,0" Content="Next Group" Direction="Right" VerticalAlignment="Bottom"
                  Command="{Binding SelectedEvent.CycleEventCommand}" CommandParameter="{x:Static map:EventCycleDirection.NextCategory}" />
         </Grid>
         <ItemsControl DockPanel.Dock="Top" ItemsSource="{Binding PrimaryMap.EventSelectors}" HorizontalAlignment="Center">
            <ItemsControl.ItemsPanel>
               <ItemsPanelTemplate>
                  <WrapPanel HorizontalAlignment="Center"/>
               </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>
            <ItemsControl.ItemTemplate>
               <DataTemplate>
                  <RadioButton IsChecked="{Binding IsSelected}" />
               </DataTemplate>
            </ItemsControl.ItemTemplate>
         </ItemsControl>

         <ScrollViewer>
            <ContentControl DataContext="{Binding SelectedEvent}" Content="{Binding}">
               <ContentControl.Resources>
                  <DataTemplate DataType="{x:Type map:ObjectEventViewModel}">
                     <Grid VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>

                        <StackPanel Margin="2,2,0,2">
                           <local:AngleBorder Direction="Out">
                              <TextBlock Text="ID:"/>
                           </local:AngleBorder>
                           <local:AngleTextBox Direction="Out" TextBinding="{Binding ObjectID, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <local:AngleComboBox Grid.Row="0" Grid.Column="1" Direction="Right" SelectedIndex="{Binding Graphics}" ItemsSource="{Binding Options}" Margin="0,2,2,2">
                           <local:AngleComboBox.ItemsPanel>
                              <ItemsPanelTemplate>
                                 <WrapPanel Width="130" />
                              </ItemsPanelTemplate>
                           </local:AngleComboBox.ItemsPanel>
                        </local:AngleComboBox>

                        <local:AngleBorder Grid.Row="1" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="(x, y):" />
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="1" Grid.Column="1" Margin="0,2,2,2" VerticalAlignment="Top" Direction="Out" TextBinding="{Binding XY, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="2" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Elevation:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="2" Grid.Column="1" Margin="0,2,2,2" VerticalAlignment="Top" Direction="Out" TextBinding="{Binding Elevation, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Out" Margin="2,2,0,2">
                           <TextBlock Text="Movement Type:"/>
                        </local:AngleBorder>
                        <local:AngleComboBox Grid.Row="3" Grid.Column="1" Margin="0,2,2,2" VerticalAlignment="Top" Direction="Right" SelectedIndex="{Binding MoveType}" ItemsSource="{Binding FacingOptions}" />

                        <local:AngleBorder Grid.Row="4" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Range:" />
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="4" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding RangeXY, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="5" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Trainer Type:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="5" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding TrainerType, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="6" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock>
                              <TextBlock.Style>
                                 <Style TargetType="TextBlock" BasedOn="{StaticResource {x:Type TextBlock}}">
                                    <Setter Property="Text" Value="Trainer Range:" />
                                    <Style.Triggers>
                                       <DataTrigger Binding="{Binding TrainerType}" Value="0">
                                          <Setter Property="Text" Value="Berry ID:" />
                                       </DataTrigger>
                                    </Style.Triggers>
                                 </Style>
                              </TextBlock.Style>
                           </TextBlock>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="6" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding TrainerRangeOrBerryID, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="7" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Script Address:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="7" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,21,2" Direction="Out" TextBinding="{Binding ScriptAddressText, UpdateSourceTrigger=PropertyChanged}" />
                        <local:AngleButton Command="{res:MethodCommand GotoScript}" Direction="Right" Grid.Row="7" Grid.Column="1" HorizontalAlignment="Right"
                              Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                           <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                        </local:AngleButton>

                        <local:AngleBorder Grid.Row="8" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Flag:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="8" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding FlagText, UpdateSourceTrigger=PropertyChanged}" />

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowBerryContent, Converter={StaticResource BoolToVisibility}}">
                           <Grid>
                              <Grid.ColumnDefinitions>
                                 <ColumnDefinition />
                                 <ColumnDefinition />
                              </Grid.ColumnDefinitions>
                              <local:AngleBorder Direction="Out" Content="Initial Berry:" />
                              <local:AngleBorder Direction="Right" Grid.Column="1" Content="{Binding BerryText}" Margin="0,2,21,2" />
                              <local:AngleButton Command="{res:MethodCommand GotoBerryCode}" Direction="Right" Grid.Row="7" Grid.Column="1" HorizontalAlignment="Right"
                                    Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                                 <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                              </local:AngleButton>
                           </Grid>
                        </StackPanel>
                        
                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowTrainerContent, Converter={StaticResource BoolToVisibility}}">
                           <StackPanel.Resources>
                              <Style TargetType="TextBox" x:Key="TextBoxStyle" BasedOn="{StaticResource {x:Type TextBox}}">
                                 <Setter Property="FontFamily" Value="Consolas" />
                                 <Setter Property="AcceptsReturn" Value="True" />
                                 <Setter Property="HorizontalAlignment" Value="Right" />
                                 <Setter Property="Width" Value="244" />
                              </Style>
                           </StackPanel.Resources>
                           <Grid>
                              <Grid.ColumnDefinitions>
                                 <ColumnDefinition />
                                 <ColumnDefinition />
                              </Grid.ColumnDefinitions>
                              <local:AngleComboBox Direction="Out" ItemsSource="{Binding ClassOptions}" SelectedIndex="{Binding TrainerClass}" />
                              <local:AngleTextBox Grid.Column="1" TextBinding="{Binding TrainerName, UpdateSourceTrigger=PropertyChanged}" Direction="Right" />
                           </Grid>
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="Before Battle:" Margin="4,0"/>
                           </local:AngleBorder>
                           <TextBox Text="{Binding TrainerBeforeText, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource TextBoxStyle}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="When You Win:" Margin="4,0"/>
                           </local:AngleBorder>
                           <TextBox Text="{Binding TrainerWinText, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource TextBoxStyle}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="After Battle:" Margin="4,0"/>
                           </local:AngleBorder>
                           <TextBox Text="{Binding TrainerAfterText, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource TextBoxStyle}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="Team:" Margin="4,0"/>
                           </local:AngleBorder>
                           <Grid Background="{DynamicResource Backlight}" Width="230" HorizontalAlignment="Right">
                              <Viewbox HorizontalAlignment="Right" Height="{Binding ActualHeight, ElementName=TrainerTeamBox}" Stretch="Uniform" IsHitTestVisible="False" Opacity=".5">
                                 <ItemsControl ItemsSource="{Binding TeamVisualizations}">
                                    <ItemsControl.ItemTemplate>
                                       <DataTemplate>
                                          <local:PixelImage TransparentBrush="{DynamicResource Backlight}"/>
                                       </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                 </ItemsControl>
                              </Viewbox>
                              <TextBox VerticalAlignment="Top" Text="{Binding TrainerTeam, UpdateSourceTrigger=PropertyChanged}" Style="{StaticResource TextBoxStyle}"
                                       Name="TrainerTeamBox" Background="Transparent" Width="230" CaretBrush="{DynamicResource Secondary}" />
                           </Grid>
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="Edit More:" Margin="4,0"/>
                           </local:AngleBorder>
                           <local:AngleButton Direction="Right" HorizontalAlignment="Right" Command="{Binding OpenTrainerData}">
                              <local:PixelImage TransparentBrush="{DynamicResource Backlight}" DataContext="{Binding TrainerSprite}" />
                           </local:AngleButton>
                        </StackPanel>

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowItemContents, Converter={StaticResource BoolToVisibility}}">
                           <Grid>
                              <Grid.ColumnDefinitions>
                                 <ColumnDefinition />
                                 <ColumnDefinition />
                              </Grid.ColumnDefinitions>
                              <local:AngleBorder Direction="Left">
                                 <TextBlock Text="Item:" Margin="4,0"/>
                              </local:AngleBorder>
                              <local:AngleComboBox Grid.Column="1" Direction="Out" ItemsSource="{Binding ItemOptions}" SelectedIndex="{Binding ItemContents}" />
                           </Grid>
                        </StackPanel>

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowNpcText, Converter={StaticResource BoolToVisibility}}">
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0">
                              <TextBlock Text="Text:" Margin="4,0"/>
                           </local:AngleBorder>
                           <TextBox FontFamily="Consolas" AcceptsReturn="True" HorizontalAlignment="Right" Width="244" Text="{Binding NpcText, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowMartContents, Converter={StaticResource BoolToVisibility}}">
                           <StackPanel.Resources>
                              <Style TargetType="TextBox" x:Key="TextBoxStyle" BasedOn="{StaticResource {x:Type TextBox}}">
                                 <Setter Property="FontFamily" Value="Consolas" />
                                 <Setter Property="AcceptsReturn" Value="True" />
                                 <Setter Property="HorizontalAlignment" Value="Right" />
                                 <Setter Property="Width" Value="244" />
                              </Style>
                           </StackPanel.Resources>
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Greeting:" />
                           <TextBox Text="{Binding MartHello, UpdateSourceTrigger=PropertyChanged}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Shop:" />
                           <TextBox Text="{Binding MartContent, UpdateSourceTrigger=PropertyChanged}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Goodbye:" />
                           <TextBox Text="{Binding MartGoodbye, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowTutorContent, Converter={StaticResource BoolToVisibility}}">
                           <StackPanel.Resources>
                              <Style TargetType="TextBox" x:Key="TextBoxStyle" BasedOn="{StaticResource {x:Type TextBox}}">
                                 <Setter Property="FontFamily" Value="Consolas" />
                                 <Setter Property="AcceptsReturn" Value="True" />
                                 <Setter Property="HorizontalAlignment" Value="Right" />
                                 <Setter Property="Width" Value="244" />
                              </Style>
                           </StackPanel.Resources>
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Info:" />
                           <TextBox Text="{Binding TutorInfoText, UpdateSourceTrigger=PropertyChanged}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Which Pokemon:" />
                           <TextBox Text="{Binding TutorWhichPokemonText, UpdateSourceTrigger=PropertyChanged}" />

                           <Grid Margin="0,10,0,0">
                              <Grid.ColumnDefinitions>
                                 <ColumnDefinition />
                                 <ColumnDefinition />
                                 <ColumnDefinition Width="Auto" />
                              </Grid.ColumnDefinitions>
                              <local:AngleBorder Direction="Left" Content="Tutor Move:" />
                              <local:AngleComboBox Grid.Column="1" Direction="Out" ItemsSource="{Binding TutorOptions}" SelectedIndex="{Binding TutorNumber}" />
                              <local:AngleButton Command="{res:MethodCommand GotoTutors}" Direction="Right" Grid.Column="2" HorizontalAlignment="Right"
                                    Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                                 <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                              </local:AngleButton>
                           </Grid>

                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Sucess:" />
                           <TextBox Text="{Binding TutorSucessText, UpdateSourceTrigger=PropertyChanged}" />
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Fail:" />
                           <TextBox Text="{Binding TutorFailedText, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <StackPanel Margin="2,12" Grid.Row="9" Grid.ColumnSpan="2" Visibility="{Binding ShowTradeContent, Converter={StaticResource BoolToVisibility}}">
                           <StackPanel.Resources>
                              <Style TargetType="TextBox" x:Key="TextBoxStyle" BasedOn="{StaticResource {x:Type TextBox}}">
                                 <Setter Property="FontFamily" Value="Consolas" />
                                 <Setter Property="AcceptsReturn" Value="True" />
                                 <Setter Property="HorizontalAlignment" Value="Right" />
                                 <Setter Property="Width" Value="244" />
                              </Style>
                           </StackPanel.Resources>
                           <local:AngleBorder Content="Info:" Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" />
                           <TextBox Text="{Binding TradeInitialText, UpdateSourceTrigger=PropertyChanged}" />

                           <Grid Margin="0,10,0,0">
                              <Grid.ColumnDefinitions>
                                 <ColumnDefinition />
                                 <ColumnDefinition />
                                 <ColumnDefinition Width="Auto" />
                              </Grid.ColumnDefinitions>
                              <local:AngleBorder Direction="Left" Content="Trade:" />
                              <local:AngleComboBox Grid.Column="1" Direction="Out" ItemsSource="{Binding TradeOptions}" SelectedIndex="{Binding TradeIndex}" />
                              <local:AngleButton Command="{res:MethodCommand GotoTrades}" Direction="Right" Grid.Column="2" HorizontalAlignment="Right"
                                    Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                                 <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                              </local:AngleButton>
                           </Grid>

                           <local:AngleBorder Content="Cancel:" Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" />
                           <TextBox Text="{Binding TradeFailedText, UpdateSourceTrigger=PropertyChanged}" />

                           <local:AngleBorder Content="Wrong Pokemon:" Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" />
                           <TextBox Text="{Binding TradeWrongSpeciesText, UpdateSourceTrigger=PropertyChanged}" />

                           <local:AngleBorder Content="Success:" Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" />
                           <TextBox Text="{Binding TradeThanksText, UpdateSourceTrigger=PropertyChanged}" />

                           <local:AngleBorder Content="After Trade:" Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" />
                           <TextBox Text="{Binding TradeSuccessText, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                     </Grid>
                  </DataTemplate>
                  <DataTemplate DataType="{x:Type map:WarpEventViewModel}">
                     <Grid VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition />
                        </Grid.RowDefinitions>

                        <local:AngleBorder Grid.Row="1" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="(x, y):" />
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding XY, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="2" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Elevation:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="2" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding Elevation, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="(bank, map):"/>
                        </local:AngleBorder>
                        <StackPanel Grid.Row="3" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2">
                           <local:AngleTextBox Direction="Out" TextBinding="{Binding BankMap, UpdateSourceTrigger=PropertyChanged}" />
                           <TextBlock Text="{Binding TargetMapName}" />
                        </StackPanel>

                        <local:AngleBorder Grid.Row="4" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Warp Number:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="4" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding WarpID, UpdateSourceTrigger=PropertyChanged}" />
                     </Grid>
                  </DataTemplate>
                  <DataTemplate DataType="{x:Type map:ScriptEventViewModel}">
                     <Grid VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition />
                        </Grid.RowDefinitions>

                        <local:AngleBorder Grid.Row="1" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="(x, y):" />
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding XY, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="2" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Elevation:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="2" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding Elevation, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Trigger:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="3" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding TriggerHex, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="4" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Index:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="4" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding Index, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="7" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="Script Address:"/>
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="7" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,21,2" Direction="Out" TextBinding="{Binding ScriptAddressText, UpdateSourceTrigger=PropertyChanged}" />
                        <local:AngleButton Command="{res:MethodCommand GotoScript}" Direction="Right" Grid.Row="7" Grid.Column="1" HorizontalAlignment="Right"
                              Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                           <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                        </local:AngleButton>

                     </Grid>
                  </DataTemplate>
                  <DataTemplate DataType="{x:Type map:SignpostEventViewModel}">
                     <Grid VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition /> <RowDefinition />
                           <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <local:AngleBorder Grid.Row="0" VerticalAlignment="Top" Direction="Out" Margin="2,2,0,2" Content="(x, y):" />
                        <local:AngleTextBox Grid.Row="0" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Right" TextBinding="{Binding XY, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="1" VerticalAlignment="Top" Direction="Out" Margin="2,2,0,2" Content="Elevation:" />
                        <local:AngleTextBox Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Right" TextBinding="{Binding Elevation, UpdateSourceTrigger=PropertyChanged}" />

                        <local:AngleBorder Grid.Row="2" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2" Content="Kind:" />
                        <local:AngleComboBox Grid.Row="2" Grid.Column="1" Direction="Out" Margin="0,2,2,2" ItemsSource="{Binding KindOptions}" SelectedIndex="{Binding Kind}" />

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Out" Margin="2,2,0,2" Content="Secret Base ID:"
                           Visibility="{Binding ShowArg, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleTextBox Grid.Row="3" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Left"
                           TextBinding="{Binding ArgText, UpdateSourceTrigger=PropertyChanged}"
                           Visibility="{Binding ShowArg, Converter={StaticResource BoolToVisibility}}" />

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Out" Margin="2,2,0,2" Content="Script:"
                           Visibility="{Binding ShowPointer, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleTextBox Grid.Row="3" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,24,2" Direction="Right"
                           TextBinding="{Binding PointerText, UpdateSourceTrigger=PropertyChanged}"
                           Visibility="{Binding ShowPointer, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleButton Grid.Row="3" Grid.Column="1" HorizontalAlignment="Right" Direction="Right" Command="{res:MethodCommand GotoScript}"
                           Visibility="{Binding ShowPointer, Converter={StaticResource BoolToVisibility}}"
                           Width="22" Height="18" IsTabStop="False" Padding="0,2" BorderBrush="{DynamicResource Backlight}">
                           <Path Data="{res:Icon RightAngleArrow}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
                        </local:AngleButton>

                        <StackPanel Margin="2,12" Grid.Row="4" Grid.RowSpan="4" Grid.ColumnSpan="2" Visibility="{Binding ShowSignpostText, Converter={StaticResource BoolToVisibility}}">
                           <local:AngleBorder Direction="Right" HorizontalAlignment="Left" Margin="4,10,0,0" Content="Text" />
                           <TextBox FontFamily="Consolas" AcceptsReturn="True" HorizontalAlignment="Right" Width="244" Text="{Binding SignpostText, UpdateSourceTrigger=PropertyChanged}" />
                        </StackPanel>

                        <local:AngleBorder Grid.Row="3" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2" Content="Item:"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleComboBox Grid.Row="3" Grid.Column="1" Margin="0,2,2,2" Direction="Out" ItemsSource="{Binding ItemOptions}" SelectedIndex="{Binding ItemID}"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />

                        <!-- Hidden Item ID -->
                        <local:AngleBorder Grid.Row="4" VerticalAlignment="Top" Direction="Right" Margin="2,2,0,2" Content="Hidden Item ID:"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleTextBox Grid.Row="4" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Right"
                           TextBinding="{Binding HiddenItemID, UpdateSourceTrigger=PropertyChanged}"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />

                        <!-- Quantity -->
                        <local:AngleBorder Grid.Row="5" VerticalAlignment="Top" Direction="Right" Margin="2,2,0,2" Content="Quantity:"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />
                        <local:AngleTextBox Grid.Row="5" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Right"
                           TextBinding="{Binding Quantity, UpdateSourceTrigger=PropertyChanged}"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />

                        <!-- IsUnderfoot -->
                        <CheckBox Grid.Row="6" Grid.ColumnSpan="2" HorizontalAlignment="Center" Content="Is Beneath Player"
                           IsChecked="{Binding IsUnderFoot}"
                           Visibility="{Binding ShowHiddenItemProperties, Converter={StaticResource BoolToVisibility}}" />
                     </Grid>
                  </DataTemplate>
                  <DataTemplate DataType="{x:Type map:FlyEventViewModel}">
                     <Grid VerticalAlignment="Top">
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                        </Grid.RowDefinitions>

                        <local:AngleBorder Grid.Row="1" VerticalAlignment="Top" Direction="Left" Margin="2,2,0,2">
                           <TextBlock Text="(x, y):" />
                        </local:AngleBorder>
                        <local:AngleTextBox Grid.Row="1" Grid.Column="1" VerticalAlignment="Top" Margin="0,2,2,2" Direction="Out" TextBinding="{Binding XY, UpdateSourceTrigger=PropertyChanged}" />
                     </Grid>
                  </DataTemplate>
               </ContentControl.Resources>
            </ContentControl>
         </ScrollViewer>
      </DockPanel>

      <!-- Header Panel -->
      <ScrollViewer Grid.Column="0" Grid.RowSpan="2" Background="{DynamicResource Background}" Panel.ZIndex="1" Name="HeaderPanel"
         Width="{Binding ActualWidth, ElementName=BlockPanel}"
         Visibility="{Binding ShowHeaderPanel, Converter={StaticResource BoolToVisibility}}">
         <StackPanel>
            <Grid>
               <local:AngleBorder Width="100" HorizontalAlignment="Center" Direction="Out" Content="Map Header" HorizontalContentAlignment="Center" />
               <Button Width="20" Height="20" HorizontalAlignment="Right" Margin="1" Command="{res:MethodCommand Cancel}">
                  <Path Data="{res:Icon Exit}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
               </Button>
            </Grid>
            <local:AngleButton  Direction="Out" Margin="5" Content="View Table in Data Tab" DataContext="{Binding PrimaryMap}" Command="{res:MethodCommand GotoData}" />
            <Grid DataContext="{Binding PrimaryMap.Header}">
               <Grid.ColumnDefinitions>
                  <ColumnDefinition /> <ColumnDefinition />
               </Grid.ColumnDefinitions>
               <Grid.RowDefinitions>
                  <RowDefinition /> <RowDefinition />
               </Grid.RowDefinitions>
               <local:AngleBorder Direction="Left" Content="Primary Blockset: " />
               <local:AngleBorder Grid.Row="1" Direction="Left" Content="Secondary Blockset: " />

               <local:AngleComboBox Grid.Column="1" Direction="Out" Margin="0,2,2,2" SelectedIndex="{Binding PrimaryIndex}" ItemsSource="{Binding PrimaryOptions}" />
               <local:AngleComboBox Grid.Column="1" Direction="Out" Margin="0,2,2,2" SelectedIndex="{Binding SecondaryIndex}" ItemsSource="{Binding SecondaryOptions}" Grid.Row="1" />
            </Grid>
            <Grid Height="20" Margin="0,5,0,25">
               <local:AngleButton Content="Data Operations" Width="160" Direction="Out" Padding="2,0" x:Name="DataOperations" />
               <Popup DataContext="{Binding PrimaryMap.MapRepointer}" Width="420" Height="320" IsOpen="{Binding IsChecked, ElementName=DataOperations}" StaysOpen="{Binding IsMouseOver, ElementName=DataOperations}">
                  <Border Background="{DynamicResource Background}" BorderThickness="1" BorderBrush="{DynamicResource Accent}">
                     <Grid>
                        <Grid.RowDefinitions>
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                           <RowDefinition />
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                           <ColumnDefinition />
                           <ColumnDefinition />
                           <ColumnDefinition />
                           <ColumnDefinition />
                           <ColumnDefinition />
                           <ColumnDefinition />
                           <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid.Resources>
                           <Style TargetType="local:AngleButton" BasedOn="{StaticResource {x:Type local:AngleButton}}">
                              <Setter Property="Margin" Value="2,4" />
                              <Setter Property="Padding" Value="0" />
                              <Setter Property="Height" Value="27" />
                              <Setter Property="ToolTipService.InitialShowDelay" Value="200" />
                           </Style>
                           <Style TargetType="local:AngleBorder" BasedOn="{StaticResource {x:Type local:AngleBorder}}">
                              <Setter Property="VerticalAlignment" Value="Center" />
                              <Setter Property="Margin" Value="0,4,0,0" />
                              <Setter Property="HorizontalContentAlignment" Value="Center" />
                           </Style>
                           <Style TargetType="local:AngleMenuItem" BasedOn="{StaticResource {x:Type local:AngleMenuItem}}">
                              <Setter Property="Header" Value="File" />
                              <Setter Property="Width" Value="56" />
                              <Setter Property="Margin" Value="0,8,0,4" />
                              <Setter Property="Background" Value="{DynamicResource Backlight}" />
                           </Style>
                           <Style TargetType="Menu" BasedOn="{StaticResource {x:Type Menu}}">
                              <Setter Property="Background" Value="Transparent" />
                              <Setter Property="HorizontalAlignment" Value="Center" />
                              <Setter Property="VerticalAlignment" Value="Center" />
                           </Style>
                        </Grid.Resources>
                        <!-- Repoint Layout -->
                        <local:AngleButton Content="Repoint Layout" Direction="Out" Grid.ColumnSpan="7" Width="200"
                                           ToolTip="{Binding RepointLayoutText}" Command="{Binding RepointLayout}" />
                        <!-- Repoint Border Block -->
                        <Menu Grid.Row="1" Grid.Column="0">
                           <local:AngleMenuItem Direction="Left">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportBorderBlock}" ToolTip="Import a single .bin file." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportBorderBlock}" ToolTip="Export a single .bin file." />
                           </local:AngleMenuItem>
                        </Menu>
                        <local:AngleButton Content="Repoint Border Block" Direction="Out" Grid.Row="1" Grid.ColumnSpan="7" Width="200"
                                           ToolTip="{Binding RepointBorderText}" Command="{Binding RepointBorderBlock}" />
                        <!-- Repoint Blockmap -->
                        <Menu Grid.Row="2" Grid.Column="0">
                           <local:AngleMenuItem Direction="Left">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportBlockMap}" ToolTip="Import a single .bin file." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportBlockMap}" ToolTip="Export a single .bin file." />
                           </local:AngleMenuItem>
                        </Menu>
                        <local:AngleButton Content="Repoint Blockmap" Direction="Out" Grid.Row="2" Grid.ColumnSpan="7" Width="200"
                                           ToolTip="{Binding RepointBlockMap}" Command="{Binding RepointBlockMap}" />
                        <!-- Primary / Secondary lables -->
                        <local:AngleBorder Content="Primary" Direction="Left" Grid.Row="3" Grid.Column="0" Grid.ColumnSpan="3" />
                        <local:AngleBorder Content="Secondary" Direction="Right" Grid.Row="3" Grid.Column="4" Grid.ColumnSpan="3" />
                        <!-- Repoint Blockset -->
                        <local:AngleButton Content="Repoint" Direction="Left" Grid.Row="4" Grid.Column="1" Grid.ColumnSpan="2"
                                           ToolTip="{Binding RepointPrimaryBlocksetText}" Command="{Binding RepointPrimaryBlockset}" />
                        <local:AngleBorder Content="Blockset" Direction="Out" Grid.Row="4" Grid.Column="3" />
                        <local:AngleButton Content="Repoint" Direction="Right" Grid.Row="4" Grid.Column="4" Grid.ColumnSpan="2"
                                           ToolTip="{Binding RepointSecondaryBlocksetText}" Command="{Binding RepointSecondaryBlockset}" />
                        <!-- Expand Blocks/Attributes -->
                        <Menu Grid.Row="5" Grid.Column="0" ToolTip="Blocks are stored as a pair of .bin files, one for the visuals and one for the attributes.">
                           <local:AngleMenuItem Direction="Left">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportPrimaryBlocks}" ToolTip="Import a pair of .bin files." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportPrimaryBlocks}" ToolTip="Export a pair of .bin files." />
                           </local:AngleMenuItem>
                        </Menu>
                        <local:AngleButton Content="Repoint" Direction="Left" Grid.Row="5" Grid.Column="1"
                                           ToolTip="{Binding RepointPrimaryBlocksText}" Command="{Binding RepointPrimaryBlocks}" />
                        <local:AngleButton Content="Expand" Direction="Left" Grid.Row="5" Grid.Column="2"
                                           ToolTip="{Binding ExpandPrimaryBlocksText}" Command="{Binding ExpandPrimaryBlocks}" />
                        <local:AngleBorder Content="Blocks" Direction="Out" Grid.Row="5" Grid.Column="3" />

                        <local:AngleButton Content="Expand" Direction="Right" Grid.Row="5" Grid.Column="4"
                                           ToolTip="{Binding ExpandSecondaryBlocksText}" Command="{Binding ExpandSecondaryBlocks}" />
                        <local:AngleButton Content="Repoint" Direction="Right" Grid.Row="5" Grid.Column="5"
                                           ToolTip="{Binding RepointSecondaryBlocksText}" Command="{Binding RepointSecondaryBlocks}" />
                        <Menu Grid.Row="5" Grid.Column="6" ToolTip="Blocks are stored as a pair of .bin files, one for the visuals and one for the attributes.">
                           <local:AngleMenuItem Direction="Right">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportSecondaryBlocks}" ToolTip="Import a pair of .bin files." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportSecondaryBlocks}" ToolTip="Export a pair of .bin files." />
                           </local:AngleMenuItem>
                        </Menu>
                        <!-- Tileset -->
                        <Menu Grid.Row="6" Grid.Column="0" ToolTip="Tilesets are stored as a single .bin file that contains all the tiles.">
                           <local:AngleMenuItem Direction="Left">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportPrimaryTileset}" ToolTip="Import a single .bin file." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportPrimaryTileset}" ToolTip="Export a single .bin file." />
                           </local:AngleMenuItem>
                        </Menu>
                        <local:AngleButton Content="Repoint" Direction="Left" Grid.Row="6" Grid.Column="1"
                                           ToolTip="{Binding RepointPrimaryTilesetText}" Command="{Binding RepointPrimaryTileset}" />
                        <local:AngleButton Content="Expand" Direction="Left" Grid.Row="6" Grid.Column="2"
                                           ToolTip="{Binding ExpandPrimaryTilesetText}" Command="{Binding ExpandPrimaryTileset}" />
                        <local:AngleBorder Content="Tileset" Direction="Out" Grid.Row="6" Grid.Column="3" />
                        <local:AngleButton Content="Expand" Direction="Right" Grid.Row="6" Grid.Column="4"
                                           ToolTip="{Binding ExpandSecondaryTilesetText}" Command="{Binding ExpandSecondaryTileset}" />
                        <local:AngleButton Content="Repoint" Direction="Right" Grid.Row="6" Grid.Column="5"
                                           ToolTip="{Binding RepointSecondaryTilesetText}" Command="{Binding RepointSecondaryTileset}" />
                        <Menu Grid.Row="6" Grid.Column="6" ToolTip="Tilesets are stored as a single .bin file that contains all the tiles.">
                           <local:AngleMenuItem Direction="Right">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportSecondaryTileset}" ToolTip="Import a single .bin file."/>
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportSecondaryTileset}" ToolTip="Export a single .bin file." />
                           </local:AngleMenuItem>
                        </Menu>
                        <!-- Palette -->
                        <Menu Grid.Row="7" Grid.Column="0" ToolTip="Palettes are stored as 16 .pal files, one for each palette in the collection.">
                           <local:AngleMenuItem Direction="Left">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportPrimaryPalette}" ToolTip="Import files named 00.pal, 01.pal, ... 0F.pal, 10.pal from a single folder." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportPrimaryPalette}" ToolTip="Export files named 00.pal, 01.pal, ... 0F.pal, 10.pal to a single folder." />
                           </local:AngleMenuItem>
                        </Menu>
                        <local:AngleButton Content="Repoint" Direction="Left" Grid.Row="7" Grid.Column="1"
                                           ToolTip="{Binding RepointPrimaryPaletteText}" Command="{Binding RepointPrimaryPalette}" />
                        <local:AngleButton Content="Expand" Direction="Left" Grid.Row="7" Grid.Column="2"
                                           ToolTip="{Binding ExpandPrimaryPaletteText}" Command="{Binding ExpandPrimaryPalette}" />
                        <local:AngleBorder Content="Palette" Direction="Out" Grid.Row="7" Grid.Column="3" />
                        <local:AngleButton Content="Expand" Direction="Right" Grid.Row="7" Grid.Column="4"
                                           ToolTip="{Binding ExpandSecondaryPaletteText}" Command="{Binding ExpandSecondaryPalette}" />
                        <local:AngleButton Content="Repoint" Direction="Right" Grid.Row="7" Grid.Column="5"
                                           ToolTip="{Binding RepointSecondaryPaletteText}" Command="{Binding RepointSecondaryPalette}" />
                        <Menu Grid.Row="7" Grid.Column="6" ToolTip="Palettes are stored as 16 .pal files, one for each palette in the collection.">
                           <local:AngleMenuItem Direction="Right">
                              <MenuItem Header="Import" Command="{res:MethodCommand ImportSecondaryPalette}" ToolTip="Import files named 00.pal, 01.pal, ... 0F.pal, 10.pal from a single folder." />
                              <MenuItem Header="Export" Command="{res:MethodCommand ExportSecondaryPalette}" ToolTip="Export files named 00.pal, 01.pal, ... 0F.pal, 10.pal to a single folder." />
                           </local:AngleMenuItem>
                        </Menu>
                        <!-- Create Primary Animations -->
                        <local:AngleButton Content="Create" Direction="Left" Grid.Row="8" Grid.Column="1"
                                           ToolTip="{Binding CreatePrimaryTilesetAnimationsText}" Command="{Binding CreatePrimaryTilesetAnimations}" />
                        <local:AngleBorder Content="Animation" Direction="Out" Grid.Row="8" Grid.Column="2" Grid.ColumnSpan="3" />
                        <local:AngleButton Content="Create" Direction="Right" Grid.Row="8" Grid.Column="5"
                                           ToolTip="{Binding CreatePrimaryTilesetAnimationsText}" Command="{Binding CreateSecondaryTilesetAnimations}" />
                        <!-- Duplicate Map (Using Same Layout) -->
                        <local:AngleButton Content="Duplicate Map" Direction="Out" Grid.Row="9" Grid.Column="1" Grid.ColumnSpan="5" Width="200"
                                           ToolTip="{Binding DuplicateMapText}" Command="{Binding DuplicateMap}" />
                     </Grid>
                  </Border>
               </Popup>
            </Grid>
            <Grid DataContext="{Binding PrimaryMap.Header}" VerticalAlignment="Top">
               <Grid.ColumnDefinitions>
                  <ColumnDefinition />
                  <ColumnDefinition />
               </Grid.ColumnDefinitions>
               <Grid.RowDefinitions>
                  <RowDefinition /> <RowDefinition />
                  <RowDefinition /> <RowDefinition />
                  <RowDefinition /> <RowDefinition />
                  <RowDefinition /> <RowDefinition />
               </Grid.RowDefinitions>
               <Grid.Resources>
                  <Style TargetType="local:AngleBorder" BasedOn="{StaticResource {x:Type local:AngleBorder}}">
                     <Setter Property="Direction" Value="Out" />
                     <Setter Property="Margin" Value="1,2,0,2" />
                  </Style>
                  <Style TargetType="local:AngleTextBox" BasedOn="{StaticResource {x:Type local:AngleTextBox}}">
                     <Setter Property="Direction" Value="Right" />
                     <Setter Property="Grid.Column" Value="1" />
                     <Setter Property="HorizontalAlignment" Value="Stretch" />
                     <Setter Property="Margin" Value="0,2,4,2" />
                  </Style>
               </Grid.Resources>
               <local:AngleBorder  Grid.Row="0" Content="Music:" Direction="Left" />
               <local:AngleComboBox Grid.Row="0" Grid.Column="1" Direction="Out" Margin="0,2,4,2"
                                    ItemsSource="{Binding MusicOptions}" SelectedIndex="{Binding Music}"
                                    Visibility="{Binding HasMusicOptions, Converter={StaticResource BoolToVisibility}}" />

               <local:AngleBorder  Grid.Row="1" Content="Cave:" Direction="Left" />
               <local:AngleComboBox Grid.Row="1" Grid.Column="1" SelectedIndex="{Binding Cave}" ItemsSource="{Binding CaveOptions}" Direction="Out" Margin="0,2,4,2" />

               <local:AngleBorder  Grid.Row="2" Content="Weather:" Direction="Left" />
               <local:AngleComboBox Grid.Row="2" Grid.Column="1" SelectedIndex="{Binding Weather}" ItemsSource="{Binding WeatherOptions}" Direction="Out" Margin="0,2,4,2" />

               <local:AngleBorder  Grid.Row="3" Content="MapType:" Direction="Left" />
               <local:AngleComboBox Grid.Row="3" Grid.Column="1" Direction="Out" Margin="0,2,4,2"
                                    ItemsSource="{Binding MapTypeOptions}" SelectedIndex="{Binding MapType}"
                                    Visibility="{Binding HasMapTypeOptions, Converter={StaticResource BoolToVisibility}}" />

               <CheckBox Grid.Row="4" Grid.Column="0" Content="Allow Running"  IsChecked="{Binding AllowRunning}" Margin="4,2" />
               <CheckBox Grid.Row="4" Grid.Column="1" Content="Show Map Name"  IsChecked="{Binding ShowMapName}" Margin="4,2" />

               <CheckBox Grid.Row="5" Grid.Column="0" Content="Allow Biking"   IsChecked="{Binding AllowBiking}" Margin="4,2" Visibility="{Binding ShowAllowBikingField, Converter={StaticResource BoolToVisibility}}" />
               <CheckBox Grid.Row="5" Grid.Column="1" Content="Allow Escaping" IsChecked="{Binding AllowEscaping}" Margin="4,2" />

               <local:AngleBorder  Grid.Row="6" Content="BattleType:" Direction="Left" />
               <local:AngleComboBox Grid.Row="6" Grid.Column="1" Direction="Out" Margin="0,2,4,2" SelectedIndex="{Binding BattleType}" ItemsSource="{Binding BattleOptions}" />

               <local:AngleBorder  Grid.Row="7" Content="FloorNum:" Visibility="{Binding ShowFloorNumField, Converter={StaticResource BoolToVisibility}}" />
               <local:AngleTextBox Grid.Row="7" TextBinding="{Binding FloorNum, UpdateSourceTrigger=PropertyChanged}" Visibility="{Binding ShowFloorNumField, Converter={StaticResource BoolToVisibility}}" />
            </Grid>
            <local:AngleBorder Direction="Out" Content="Map Scripts:" Margin="8,8,8,2" />
            <ItemsControl ItemsSource="{Binding PrimaryMap.MapScriptCollection.Scripts}">
               <ItemsControl.ItemTemplate>
                  <DataTemplate>
                     <StackPanel>
                        <DockPanel Margin="2">
                           <DockPanel.Resources>
                              <DataTemplate DataType="{x:Type models:VisualOption}">
                                 <TextBlock Text="{Binding Option}">
                                    <TextBlock.ToolTip>
                                       <TextBlock>
                                          <Bold>
                                             <Run Text="{Binding ShortDescription}" />
                                          </Bold>
                                          <LineBreak /> <LineBreak />
                                          <Run Text="{Binding Description}" />
                                       </TextBlock>
                                    </TextBlock.ToolTip>
                                    </TextBlock>
                              </DataTemplate>
                           </DockPanel.Resources>
                           <local:AngleButton Command="{res:MethodCommand Delete}" DockPanel.Dock="Left" Direction="Left" Padding="0" VerticalAlignment="Center" Height="18">
                              <Path Fill="{DynamicResource Secondary}" Stretch="Uniform" Data="{res:Icon Exit}" Width="10" Height="20"/>
                           </local:AngleButton>
                           <local:AngleButton Command="{res:MethodCommand Goto}" DockPanel.Dock="Right" Direction="Right" Padding="0" Width="20" Height="18">
                              <Path Fill="{DynamicResource Secondary}" Stretch="Fill" Data="{res:Icon RightAngleArrow}" Width="10" Height="12" />
                           </local:AngleButton>
                           <local:AngleComboBox SelectedIndex="{Binding ScriptTypeIndex}" ItemsSource="{Binding ScriptOptions}" Direction="Out" DockPanel.Dock="Left" Width="140" Height="18" />
                           <local:AngleTextBox Direction="Right" TextBinding="{Binding Address, UpdateSourceTrigger=PropertyChanged}" />
                        </DockPanel>
                        <ItemsControl Visibility="{Binding HasSubScripts, Converter={StaticResource BoolToVisibility}}" ItemsSource="{Binding SubScripts}">
                           <ItemsControl.ItemTemplate>
                              <DataTemplate>
                                 <StackPanel Margin="8,2">
                                    <!-- Do I need multiple lines for this? -->
                                    <!-- One line for Delete, Address, Goto -->
                                    <!-- One line for variable/value pair -->
                                    <DockPanel>
                                       <local:AngleButton Command="{res:MethodCommand Delete}" DockPanel.Dock="Left" Direction="Left" Padding="0" VerticalAlignment="Center" Height="18">
                                          <Path Fill="{DynamicResource Secondary}" Stretch="Uniform" Data="{res:Icon Exit}" Width="10" Height="20" />
                                       </local:AngleButton>
                                       <local:AngleButton Command="{res:MethodCommand Goto}" DockPanel.Dock="Right" Direction="Right" Padding="0" Width="20" Height="18">
                                          <Path Fill="{DynamicResource Secondary}" Stretch="Fill" Data="{res:Icon RightAngleArrow}" Width="10" Height="12" />
                                       </local:AngleButton>
                                       <local:AngleBorder Direction="Left" Content="Address:" Padding="2,0" />
                                       <local:AngleTextBox Direction="Out" TextBinding="{Binding Address, UpdateSourceTrigger=PropertyChanged}" />
                                    </DockPanel>
                                    <UniformGrid Columns="4" Margin="20,0">
                                       <local:AngleBorder Direction="Out" Content="Var:" />
                                       <local:AngleTextBox Direction="Right" TextBinding="{Binding Variable, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,2,0" />
                                       <local:AngleBorder Direction="Out" Content="Value:" Margin="2,0,0,0" />
                                       <local:AngleTextBox Direction="Right" TextBinding="{Binding Value, UpdateSourceTrigger=PropertyChanged}" />
                                    </UniformGrid>
                                 </StackPanel>
                              </DataTemplate>
                           </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <local:AngleButton Margin="8,2" Visibility="{Binding HasSubScripts, Converter={StaticResource BoolToVisibility}}" Command="{res:MethodCommand AddSubScript}" Direction="Out" Content="Add Table Script" />
                     </StackPanel>
                  </DataTemplate>
               </ItemsControl.ItemTemplate>
            </ItemsControl>
            <local:AngleButton DataContext="{Binding PrimaryMap.MapScriptCollection}" Content="Add New Script" Direction="Out" Margin="2" Command="{res:MethodCommand AddScript}" />
         </StackPanel>
      </ScrollViewer>

      <!-- Main View -->
      <ItemsControl Grid.Column="1" Grid.Row="1" Name="MapView" ItemsSource="{Binding VisibleMaps}"
                    SnapsToDevicePixels="True" ClipToBounds="True" Focusable="False"
                    MouseDown="ButtonDown" MouseMove="ButtonMove" MouseUp="ButtonUp" MouseLeave="ButtonLeave" MouseWheel="Wheel">
         <ItemsControl.RenderTransform>
            <TranslateTransform/>
         </ItemsControl.RenderTransform>
         <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
               <Canvas HorizontalAlignment="Center" VerticalAlignment="Center" ClipToBounds="False" SnapsToDevicePixels="True"/>
            </ItemsPanelTemplate>
         </ItemsControl.ItemsPanel>
         <ItemsControl.ItemContainerStyle>
            <Style>
               <Setter Property="Canvas.Top" Value="{Binding TopEdge}" />
               <Setter Property="Canvas.Left" Value="{Binding LeftEdge}" />
            </Style>
         </ItemsControl.ItemContainerStyle>
         <ItemsControl.ItemTemplate>
            <DataTemplate>
               <local:PixelImage />
            </DataTemplate>
         </ItemsControl.ItemTemplate>
         <ItemsControl.ContextMenu>
            <ContextMenu IsEnabled="False" ContextMenuClosing="DisableMenuOnClose" ItemsSource="{Binding ContextItems}">
               <ContextMenu.ItemContainerStyle>
                  <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                     <Setter Property="Header" Value="{Binding Text}" />
                     <Setter Property="Command" Value="{Binding}" />
                  </Style>
               </ContextMenu.ItemContainerStyle>
            </ContextMenu>
         </ItemsControl.ContextMenu>
      </ItemsControl>
      <ItemsControl Grid.Column="1" Grid.Row="1" Name="MapButtons" ItemsSource="{Binding MapButtons}" Focusable="False">
         <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
               <Canvas HorizontalAlignment="Center" VerticalAlignment="Center" ClipToBounds="False" />
            </ItemsPanelTemplate>
         </ItemsControl.ItemsPanel>
         <ItemsControl.ItemContainerStyle>
            <Style>
               <Style.Triggers>
                  <DataTrigger Binding="{Binding AnchorLeftEdge}" Value="True">
                     <Setter Property="Canvas.Left" Value="{Binding AnchorPositionX}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding AnchorLeftEdge}" Value="False">
                     <Setter Property="Canvas.Right" Value="{Binding AnchorPositionX}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding AnchorTopEdge}" Value="True">
                     <Setter Property="Canvas.Top" Value="{Binding AnchorPositionY}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding AnchorTopEdge}" Value="False">
                     <Setter Property="Canvas.Bottom" Value="{Binding AnchorPositionY}"/>
                  </DataTrigger>
               </Style.Triggers>
            </Style>
         </ItemsControl.ItemContainerStyle>
         <ItemsControl.ItemTemplate>
            <DataTemplate>
               <Border Name="PathBackground" MouseLeftButtonDown="ShifterDown" MouseMove="ShifterMove" MouseLeftButtonUp="ShifterUp" Width="20" Height="20"
                       Background="{DynamicResource Backlight}" ToolTipService.InitialShowDelay="0">
                  <Path Name="Path" Fill="{DynamicResource Secondary}" Stretch="Uniform" />
                  <Border.ContextMenu>
                     <ContextMenu IsEnabled="{Binding EnableContextMenu}" ItemsSource="{Binding ContextItems}">
                        <ContextMenu.ItemContainerStyle>
                           <Style TargetType="MenuItem" BasedOn="{StaticResource {x:Type MenuItem}}">
                              <Setter Property="Header" Value="{Binding Text}" />
                              <Setter Property="Command" Value="{Binding}" />
                              <Setter Property="CommandParameter" Value="{Binding Parameter}" />
                           </Style>
                        </ContextMenu.ItemContainerStyle>
                     </ContextMenu>
                  </Border.ContextMenu>
                  <Border.ToolTip>
                     <ToolTip Content="{Binding Tooltip}" />
                  </Border.ToolTip>
               </Border>
               <DataTemplate.Triggers>
                  <DataTrigger Binding="{Binding Icon}" Value="ExtendLeft">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon LineArrowLeft}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Icon}" Value="ExtendUp">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon LineArrowUp}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Icon}" Value="ExtendRight">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon LineArrowRight}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Icon}" Value="ExtendDown">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon LineArrowDown}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Icon}" Value="LeftRight">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon ArrowsLeftRight}"/>
                  </DataTrigger>
                  <DataTrigger Binding="{Binding Icon}" Value="UpDown">
                     <Setter TargetName="Path" Property="Data" Value="{res:Icon ArrowsUpDown}"/>
                  </DataTrigger>
               </DataTemplate.Triggers>
            </DataTemplate>
         </ItemsControl.ItemTemplate>
      </ItemsControl>
      <Rectangle Grid.Column="1" Grid.Row="1" Name="HighlightCursorRect" StrokeThickness="2" IsHitTestVisible="False" Margin="-2,-2,0,0" Visibility="{Binding ShowHighlightCursor, Converter={StaticResource BoolToVisibility}}"
         HorizontalAlignment="Center" VerticalAlignment="Center" Stroke="{DynamicResource Backlight}"
         Width="{Binding HighlightCursorWidth, Mode=OneWay}" Height="{Binding HighlightCursorHeight, Mode=OneWay}">
         <Rectangle.RenderTransform>
            <TranslateTransform X="{Binding HighlightCursorX, Mode=OneWay}" Y="{Binding HighlightCursorY, Mode=OneWay}"/>
         </Rectangle.RenderTransform>
      </Rectangle>
      <Canvas Width="160" Height="16" Background="{DynamicResource Background}" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Bottom">
         <TextBlock Canvas.Left="20" Text="{Binding HoverPoint}" Background="{DynamicResource Background}" />
         <TextBlock Canvas.Left="90" Text="{Binding ZoomLevel}" Background="{DynamicResource Background}" />
      </Canvas>

      <!-- Tile Panel -->
      <Border Grid.Column="1" Grid.RowSpan="2" Panel.ZIndex="3" HorizontalAlignment="Left"
              BorderBrush="{DynamicResource Backlight}" BorderThickness="1" MouseWheel="EatMouseWheel"
              Background="{DynamicResource Background}">
         <DockPanel Name="TilePanel" Width="400" HorizontalAlignment="Right">
            <Grid DockPanel.Dock="Top" DataContext="{Binding PrimaryMap.BlockEditor}">
               <ToggleButton IsChecked="{Binding ShowTiles}" Width="20" Height="20" HorizontalAlignment="Right" Margin="1">
                  <Path Data="{res:Icon Exit}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
               </ToggleButton>
               <local:AngleBorder HorizontalAlignment="Center" HorizontalContentAlignment="Center" Width="100" Content="Selected Block" Direction="Out" DockPanel.Dock="Top" />
            </Grid>
            <Decorator Visibility="{Binding BlockEditorVisible, Converter={StaticResource BoolToVisibility}}" Margin="0,10" DockPanel.Dock="Top" Height="115">
               <local:SelectedBlockEditor x:Name="BlockEditor" DataContext="{Binding PrimaryMap.BlockEditor}" HorizontalAlignment="Center" Width="300"/>
            </Decorator>
            <local:AngleBorder HorizontalAlignment="Center" HorizontalContentAlignment="Center" Width="100" Content="Tiles" Direction="Out" DockPanel.Dock="Top" />
            <StackPanel DockPanel.Dock="Top" HorizontalAlignment="Center" Orientation="Horizontal" Margin="0,0,0,4" DataContext="{Binding PrimaryMap.BlockEditor}">
               <TextBlock Text="Selected Tile:" VerticalAlignment="Center" Margin="5,0"/>
               <Border Padding="2" BorderBrush="{DynamicResource Secondary}" BorderThickness="1" Margin="0,0,30,0" VerticalAlignment="Center">
                  <local:PixelImage DataContext="{Binding DrawTileRender}" TransparentBrush="{DynamicResource Background}" />
               </Border>
               <TextBlock VerticalAlignment="Center" Margin="5,0" TextAlignment="Center">
                  <Run Text="Selected Palette:" />
                  <LineBreak />
                  <Run Text="(" />
                  <Run Text="{Binding PaletteSelection, Mode=OneWay}" />
                  <Run Text=")" />
               </TextBlock>
               <ComboBox ItemsSource="{Binding Palettes}" SelectedIndex="{Binding PaletteSelection}" />
            </StackPanel>
            <ScrollViewer Name="TileViewer" VerticalAlignment="Top" DataContext="{Binding PrimaryMap.BlockEditor}">
               <Grid HorizontalAlignment="Left">
                  <local:PixelImage x:Name="TileImage" DataContext="{Binding TileRender}" MouseDown="TilesDown" TransparentBrush="{DynamicResource Background}" />
                  <ContentControl HorizontalAlignment="Left" VerticalAlignment="Top" IsHitTestVisible="False">
                     <ContentControl.Template>
                        <ControlTemplate>
                           <Rectangle StrokeThickness="1" Opacity=".5" Width="24" Height="24" RenderTransformOrigin=".5,.5"
                              Stroke="{DynamicResource Background}" Fill="{DynamicResource Primary}">
                              <Rectangle.RenderTransform>
                                 <TransformGroup>
                                    <ScaleTransform x:Name="SelectionScale" />
                                    <TranslateTransform X="{Binding TileSelectionX}" Y="{Binding TileSelectionY}" />
                                 </TransformGroup>
                              </Rectangle.RenderTransform>
                           </Rectangle>
                           <ControlTemplate.Triggers>
                              <DataTrigger Binding="{Binding TileSelectionToggle}" Value="True">
                                 <DataTrigger.EnterActions>
                                    <BeginStoryboard>
                                       <Storyboard>
                                          <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleX" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                          <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleY" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                       </Storyboard>
                                    </BeginStoryboard>
                                 </DataTrigger.EnterActions>
                                 <DataTrigger.ExitActions>
                                    <BeginStoryboard>
                                       <Storyboard>
                                          <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleX" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                          <DoubleAnimation Storyboard.TargetName="SelectionScale" Storyboard.TargetProperty="ScaleY" From="3" To="1" Duration="0:0:.5" DecelerationRatio="1" />
                                       </Storyboard>
                                    </BeginStoryboard>
                                 </DataTrigger.ExitActions>
                              </DataTrigger>
                           </ControlTemplate.Triggers>
                        </ControlTemplate>
                     </ContentControl.Template>
                  </ContentControl>
               </Grid>
            </ScrollViewer>
         </DockPanel>
         <Border.Style>
            <Style TargetType="Border">
               <Setter Property="Width" Value="0" />
               <Style.Triggers>
                  <DataTrigger Binding="{Binding PrimaryMap.BlockEditor.ShowTiles}" Value="True">
                     <DataTrigger.EnterActions>
                        <BeginStoryboard>
                           <Storyboard>
                              <DoubleAnimation DecelerationRatio="1" Duration="0:0:0.3" Storyboard.TargetProperty="Width" To="402" />
                           </Storyboard>
                        </BeginStoryboard>
                     </DataTrigger.EnterActions>
                     <DataTrigger.ExitActions>
                        <BeginStoryboard>
                           <Storyboard>
                              <DoubleAnimation DecelerationRatio="1" Duration="0:0:0.3" Storyboard.TargetProperty="Width" To="0" />
                           </Storyboard>
                        </BeginStoryboard>
                     </DataTrigger.ExitActions>
                  </DataTrigger>
               </Style.Triggers>
            </Style>
         </Border.Style>
      </Border>

      <!-- Border Panel-->
      <Border DataContext="{Binding PrimaryMap.BorderEditor}" Grid.Column="1" Grid.RowSpan="2" Panel.ZIndex="3" HorizontalAlignment="Left"
              BorderBrush="{DynamicResource Backlight}" BorderThickness="1" MouseWheel="EatMouseWheel"
              Background="{DynamicResource Background}">
         <DockPanel Width="400" HorizontalAlignment="Right">
            <Grid DockPanel.Dock="Top">
               <ToggleButton Command="{res:MethodCommand ToggleBorderEditor}" Width="20" Height="20" HorizontalAlignment="Right" Margin="1">
                  <Path Data="{res:Icon Exit}" Fill="{DynamicResource Secondary}" Stretch="Fill" />
               </ToggleButton>
               <local:AngleBorder Width="100" HorizontalAlignment="Center" Direction="Out" Content="Border Block" HorizontalContentAlignment="Center" Margin="0,0,0,5" />
            </Grid>
            <Grid Visibility="{Binding HasBorderDimensions, Converter={StaticResource BoolToVisibility}}" DockPanel.Dock="Top" Margin="10">
               <Grid.RowDefinitions>
                  <RowDefinition />
                  <RowDefinition />
               </Grid.RowDefinitions>
               <Grid.ColumnDefinitions>
                  <ColumnDefinition />
                  <ColumnDefinition />
               </Grid.ColumnDefinitions>
               <local:AngleBorder Content="Width:" Direction="Out" Margin="0,0,0,5" />
               <local:AngleTextBox TextBinding="{Binding Width, UpdateSourceTrigger=PropertyChanged}" Grid.Column="1" Direction="Right" Margin="0,0,0,5" />
               <local:AngleBorder Content="Height:" Direction="Out" Grid.Row="1" />
               <local:AngleTextBox TextBinding="{Binding Height, UpdateSourceTrigger=PropertyChanged}" Grid.Row="1" Grid.Column="1" Direction="Right" />
            </Grid>
            <local:PixelImage x:Name="BorderImage" DataContext="{Binding BorderRender}" HorizontalAlignment="Center" VerticalAlignment="Center"
               MouseLeftButtonDown="BorderDown" MouseRightButtonDown="BorderSelect" MouseMove="BorderMove" MouseUp="BorderUp" />
         </DockPanel>
         <Border.Style>
            <Style TargetType="Border">
               <Setter Property="Width" Value="0" />
               <Style.Triggers>
                  <DataTrigger Binding="{Binding ShowBorderPanel}" Value="True">
                     <DataTrigger.EnterActions>
                        <BeginStoryboard>
                           <Storyboard>
                              <DoubleAnimation DecelerationRatio="1" Duration="0:0:0.3" Storyboard.TargetProperty="Width" To="402" />
                           </Storyboard>
                        </BeginStoryboard>
                     </DataTrigger.EnterActions>
                     <DataTrigger.ExitActions>
                        <BeginStoryboard>
                           <Storyboard>
                              <DoubleAnimation DecelerationRatio="1" Duration="0:0:0.3" Storyboard.TargetProperty="Width" To="0" />
                           </Storyboard>
                        </BeginStoryboard>
                     </DataTrigger.ExitActions>
                  </DataTrigger>
               </Style.Triggers>
            </Style>
         </Border.Style>
      </Border>

      <!-- Tutorials Panel -->
      <local:TutorialControl x:Name="TutorialsControl" Grid.Row="1" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" DataContext="{Binding Tutorials}" EnterTutorial="OnEnterTutorial" />

      <!-- Toolbar -->
      <StackPanel Grid.Column="1" Orientation="Horizontal" Background="{DynamicResource Background}" Margin="1,0,1,5" Panel.ZIndex="2">
         <StackPanel Margin="5,0" HorizontalAlignment="Center">
            <Button Width="12" Height="12" Padding="1" Command="{res:MethodCommand Zoom}" CommandParameter="{x:Static map:ZoomDirection.Enlarge}" ToolTip="Zoom In">
               <Path Stretch="Uniform" Fill="{DynamicResource Secondary}" Data="{res:Icon ThinPlus}" />
            </Button>
            <Button Width="12" Height="12" Padding="1" Command="{res:MethodCommand Zoom}" CommandParameter="{x:Static map:ZoomDirection.Shrink}" ToolTip="Zoom Out">
               <Path Stretch="Uniform" Fill="{DynamicResource Secondary}" Data="{res:Icon ThinMinus}" />
            </Button>
         </StackPanel>
         <local:AngleButton Direction="Left" Content="Edit Map Header" Command="{res:MethodCommand ToggleHeaderPanel}" Margin="5,0,0,0" x:Name="MapHeaderButton" />
         <local:AngleButton Direction="Out" Width="110" x:Name="WildButton" IsChecked="{Binding PrimaryMap.WildPokemon.ShowWildData}">
            <local:AngleButton.Style>
               <Style TargetType="local:AngleButton" BasedOn="{StaticResource {x:Type local:AngleButton}}">
                  <Setter Property="Content" Value="Create Wild Data" />
                  <Style.Triggers>
                     <DataTrigger Binding="{Binding PrimaryMap.WildPokemon.HasWildData}" Value="True">
                        <Setter Property="Content" Value="Edit Wild Data" />
                        <Setter Property="ToolTip">
                           <Setter.Value>
                              <ToolTip Width="200">
                                 <TextBlock TextWrapping="Wrap" Text="{Binding PrimaryMap.WildPokemon.WildSummary}" />
                              </ToolTip>
                           </Setter.Value>
                        </Setter>
                        <Setter Property="ToolTipService.InitialShowDelay" Value="0" />
                     </DataTrigger>
                  </Style.Triggers>
               </Style>
            </local:AngleButton.Style>
         </local:AngleButton>
         <Popup IsOpen="{Binding PrimaryMap.WildPokemon.ShowWildData}" PlacementTarget="{Binding ElementName=WildButton}" StaysOpen="{Binding IsMouseOver, ElementName=WildButton}">
            <Border BorderThickness="1" BorderBrush="{DynamicResource Accent}">
               <local:WildPokemonControl DataContext="{Binding PrimaryMap.WildPokemon}" />
            </Border>
         </Popup>
         <local:AngleButton Direction="Right" Content="Edit Border Block" DataContext="{Binding PrimaryMap.BorderEditor}" Command="{res:MethodCommand ToggleBorderEditor}" Margin="0,0,5,0" x:Name="EditBorderButton" />
         <Border Width="24" Height="24" BorderThickness="1" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Secondary}" Name="ObjectEventTemplate"
                 MouseLeftButtonDown="EventTemplateDown" Margin="5,0,0,0" Tag="{x:Static map:EventCreationType.Object}" ToolTipService.InitialShowDelay="0" ToolTip="Drag to Create New Object">
            <local:PixelImage DataContext="{Binding Templates.ObjectTemplateImage}" VerticalAlignment="Center" HorizontalAlignment="Center" TransparentBrush="{DynamicResource Secondary}"/>
         </Border>
         <ToggleButton Padding="0" Width="12" Height="12" VerticalAlignment="Top" Name="ShowTemplateSettingsButton" IsChecked="{Binding ShowTemplateSettings}">
            <Path Data="{res:Icon Settings}" Fill="{DynamicResource Secondary}" Stretch="Uniform"/>
         </ToggleButton>
         <Popup DataContext="{Binding Templates}" IsOpen="{Binding IsChecked, ElementName=ShowTemplateSettingsButton}" PlacementTarget="{Binding ElementName=ShowTemplateSettingsButton}"
                Width="235" Height="245" StaysOpen="{Binding IsMouseOver, ElementName=ShowTemplateSettingsButton}">
            <Border BorderBrush="{DynamicResource Secondary}" BorderThickness="1" Background="{DynamicResource Background}">
               <Grid Margin="5">
                  <Grid.ColumnDefinitions>
                     <ColumnDefinition /> <ColumnDefinition />
                  </Grid.ColumnDefinitions>
                  <Grid.RowDefinitions>
                     <RowDefinition Height="Auto" />
                     <RowDefinition Height="Auto"/>
                     <RowDefinition Height="Auto" />
                     <RowDefinition Height="Auto" />
                  </Grid.RowDefinitions>
                  <StackPanel>
                     <local:AngleBorder Direction="Left">
                        <TextBlock Text="Template:"/>
                     </local:AngleBorder>
                     <Decorator>
                        <Decorator.Style>
                           <Style TargetType="Decorator">
                              <Setter Property="Visibility" Value="Collapsed" />
                              <Style.Triggers>
                                 <DataTrigger Binding="{Binding SelectedTemplate}" Value="Item">
                                    <Setter Property="Visibility" Value="Visible" />
                                 </DataTrigger>
                              </Style.Triggers>
                           </Style>
                        </Decorator.Style>
                        <local:AngleBorder Direction="Left" Margin="0,5">
                           <TextBlock Text="Item:"/>
                        </local:AngleBorder>
                     </Decorator>
                  </StackPanel>
                  <StackPanel Grid.Column="1">
                     <local:AngleComboBox Direction="Out" ItemsSource="{Binding AvailableTemplateTypes}" SelectedItem="{Binding SelectedTemplate}" />
                     <Decorator>
                        <Decorator.Style>
                           <Style TargetType="Decorator">
                              <Setter Property="Visibility" Value="Collapsed" />
                              <Style.Triggers>
                                 <DataTrigger Binding="{Binding SelectedTemplate}" Value="Item">
                                    <Setter Property="Visibility" Value="Visible" />
                                 </DataTrigger>
                              </Style.Triggers>
                           </Style>
                        </Decorator.Style>
                        <local:AngleComboBox Direction="Out" ItemsSource="{Binding ItemOptions}" SelectedIndex="{Binding ItemID}" Margin="0,5" />
                     </Decorator>
                  </StackPanel>
                  <StackPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="0,10,0,0">
                     <StackPanel.Style>
                        <Style TargetType="StackPanel">
                           <Setter Property="Visibility" Value="Collapsed" />
                           <Style.Triggers>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="Trainer">
                                 <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                           </Style.Triggers>
                        </Style>
                     </StackPanel.Style>
                     <!-- This trainer prefers to use a level <15> <Bug> pokemon from first <50> pokemon in the <National> pokedex. -->
                     <StackPanel Orientation="Horizontal">
                        <TextBlock Text="This trainer prefers to use" />
                     </StackPanel>
                     <StackPanel Orientation="Horizontal" Margin="0,5">
                        <local:AngleBorder Direction="Left">
                           <TextBlock Margin="0,0,2,0" Text="level" />
                        </local:AngleBorder>
                        <local:AngleTextBox Width="35" Direction="Out" TextBinding="{Binding MaxLevel, UpdateSourceTrigger=PropertyChanged}" />
                        <local:AngleComboBox Width="75" ItemsSource="{Binding TypeOptions}" SelectedIndex="{Binding PreferredType}" Direction="Right" />
                        <TextBlock Margin="2,0" Text="pokemon" />
                     </StackPanel>
                     <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="2,0" Text="from the first" />
                        <local:AngleTextBox Width="35" Direction="Left" TextBinding="{Binding MaxPokedex, UpdateSourceTrigger=PropertyChanged}" />
                        <local:AngleButton Width="60" Padding="0" Height="18" Direction="Out" IsChecked="{Binding UseNationalDex}">
                           <local:AngleButton.Style>
                              <Style TargetType="local:AngleButton" BasedOn="{StaticResource {x:Type local:AngleButton}}">
                                 <Setter Property="Content" Value="Hoenn" />
                                 <Style.Triggers>
                                    <DataTrigger Binding="{Binding UseNationalDex}" Value="True">
                                       <Setter Property="Content" Value="National" />
                                    </DataTrigger>
                                 </Style.Triggers>
                              </Style>
                           </local:AngleButton.Style>
                        </local:AngleButton>
                        <TextBlock Margin="2,0" Text="pokemon." />
                     </StackPanel>
                  </StackPanel>
                  <Decorator Grid.ColumnSpan="2" Margin="5" HorizontalAlignment="Center" VerticalAlignment="Top">
                     <Decorator.Style>
                        <Style TargetType="Decorator">
                           <Setter Property="Visibility" Value="Collapsed" />
                           <Style.Triggers>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="NPC">
                                 <Setter Property="Visibility" Value="Visible" />
                                 <Setter Property="Grid.Row" Value="1" />
                              </DataTrigger>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="Tutor">
                                 <Setter Property="Visibility" Value="Visible" />
                                 <Setter Property="Grid.Row" Value="1" />
                              </DataTrigger>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="Trade">
                                 <Setter Property="Visibility" Value="Visible" />
                                 <Setter Property="Grid.Row" Value="1" />
                              </DataTrigger>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="Trainer">
                                 <Setter Property="Visibility" Value="Visible" />
                                 <Setter Property="Grid.Row" Value="2" />
                              </DataTrigger>
                           </Style.Triggers>
                        </Style>
                     </Decorator.Style>
                     <local:AngleComboBox Direction="Out" MinWidth="50" ItemsSource="{Binding GraphicsOptions}" SelectedIndex="{Binding TrainerGraphics}">
                        <local:AngleComboBox.ItemsPanel>
                           <ItemsPanelTemplate>
                              <WrapPanel MaxWidth="256" />
                           </ItemsPanelTemplate>
                        </local:AngleComboBox.ItemsPanel>
                     </local:AngleComboBox>
                  </Decorator>
                  <Decorator Grid.Row="3" Grid.ColumnSpan="2" Margin="5" HorizontalAlignment="Center">
                     <Decorator.Style>
                        <Style TargetType="Decorator">
                           <Setter Property="Visibility" Value="Collapsed" />
                           <Style.Triggers>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="Trainer">
                                 <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                           </Style.Triggers>
                        </Style>
                     </Decorator.Style>
                     <local:PixelImage DataContext="{Binding TrainerSprite}" TransparentBrush="{DynamicResource Background}" />
                  </Decorator>
                  <Grid Grid.Row="1" Grid.ColumnSpan="2" Margin="0,10,0,0">
                     <Grid.Style>
                        <Style TargetType="Grid">
                           <Setter Property="Visibility" Value="Collapsed" />
                           <Style.Triggers>
                              <DataTrigger Binding="{Binding SelectedTemplate}" Value="HMObject">
                                 <Setter Property="Visibility" Value="Visible" />
                              </DataTrigger>
                           </Style.Triggers>
                        </Style>
                     </Grid.Style>
                     <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                     </Grid.ColumnDefinitions>
                     <local:AngleBorder Direction="Left" Content="Type:" />
                     <local:AngleComboBox Grid.Column="1"  Direction="Out" ItemsSource="{Binding HMObjectOptions}" SelectedIndex="{Binding HMObjectIndex}" />
                  </Grid>
               </Grid>
            </Border>
         </Popup>
         <StackPanel Name="OtherEventTemplates" Orientation="Horizontal">
            <Border Width="24" Height="24" BorderThickness="1" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Accent}"
                    MouseLeftButtonDown="EventTemplateDown" Margin="5,0" Tag="{x:Static map:EventCreationType.Warp}"
                    ToolTipService.InitialShowDelay="0" ToolTip="Drag to Create New Warp">
               <TextBlock Text="W" HorizontalAlignment="Center" VerticalAlignment="Center" FontStyle="Italic" />
            </Border>
            <Border Width="24" Height="24" BorderThickness="1" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Stream2}"
                    MouseLeftButtonDown="EventTemplateDown" Margin="5,0" Tag="{x:Static map:EventCreationType.Script}"
                    ToolTipService.InitialShowDelay="0" ToolTip="Drag to Create New Script">
               <TextBlock Text="Sc" HorizontalAlignment="Center" VerticalAlignment="Center" FontStyle="Italic" />
            </Border>
            <Border Width="24" Height="24" BorderThickness="1" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Error}"
                    MouseLeftButtonDown="EventTemplateDown" Margin="5,0" Tag="{x:Static map:EventCreationType.Signpost}"
                    ToolTipService.InitialShowDelay="0" ToolTip="Drag to Create New Signpost">
               <TextBlock Text="Sp" HorizontalAlignment="Center" VerticalAlignment="Center" FontStyle="Italic" />
            </Border>
         </StackPanel>
         <Border Width="24" Height="24" BorderThickness="1" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Text1}"
                 Visibility="{Binding PrimaryMap.CanCreateFlyEvent, Converter={StaticResource BoolToVisibility}}"
                 MouseLeftButtonDown="EventTemplateDown" Margin="5,0" Tag="{x:Static map:EventCreationType.Fly}"
                 ToolTipService.InitialShowDelay="0" ToolTip="Drag to Create New Fly Spot">
            <TextBlock Text="F" HorizontalAlignment="Center" VerticalAlignment="Center" FontStyle="Italic" />
         </Border>
         <local:AngleBorder Direction="Left" VerticalAlignment="Stretch" Content="Map ID:" />
         <local:AngleBorder Direction="Out" VerticalAlignment="Stretch" Margin="0,0,5,0">
            <Border Width="50">
               <TextBlock Text="{Binding PrimaryMap.Name}" HorizontalAlignment="Center" />
            </Border>
         </local:AngleBorder>
         <local:AngleBorder Direction="Left" VerticalAlignment="Stretch" Content="Map Name:" />
         <local:AngleComboBox Height="18" Direction="Out" ItemsSource="{Binding PrimaryMap.AvailableNames}" SelectedIndex="{Binding PrimaryMap.SelectedNameIndex}" />
      </StackPanel>
      <Border Grid.Column="1" IsHitTestVisible="False" BorderBrush="{DynamicResource Secondary}" Background="{DynamicResource Background}" BorderThickness="0,0,0,1" Height="5" VerticalAlignment="Bottom" />
   </Grid>
</UserControl>
